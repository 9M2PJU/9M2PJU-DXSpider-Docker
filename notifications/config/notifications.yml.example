# DXSpider Notification System Configuration
#
# This file configures the notification system for DX spots.
# Copy this file to notifications.yml and customize for your needs.
#
# Environment variables can be used with ${VAR_NAME} syntax
# Example: bot_token: "${TELEGRAM_BOT_TOKEN}"

# Global notification system enable/disable
enabled: true

# Rate limiting configuration
# Prevents overwhelming external services
rate_limit:
  max_per_minute: 60  # Maximum notifications per minute across all adapters

# Notification adapters
# Each adapter can have its own filters
adapters:

  # ============================================================================
  # Discord Webhook Adapter
  # ============================================================================
  - type: discord
    name: "Main Discord Channel"
    enabled: true

    # Discord webhook URL (get from Channel Settings → Integrations → Webhooks)
    webhook_url: "${DISCORD_WEBHOOK_URL}"

    # Optional: Customize bot appearance
    username: "DXSpider"
    avatar_url: "https://example.com/avatar.png"

    # Color scheme: 'band' or 'mode'
    # band: Color coded by frequency band (160m = red, 20m = green, etc.)
    # mode: Color coded by mode (CW = gold, FT8 = blue, etc.)
    color_scheme: "band"

    # Timeout for HTTP requests (seconds)
    timeout: 10

    # Filters for this adapter
    # Multiple filters use OR logic (any match = notify)
    filters:
      # Example 1: HF bands only
      - bands: ['160m', '80m', '60m', '40m', '30m', '20m', '17m', '15m', '12m', '10m']

      # Example 2: Specific modes
      # - modes: ['CW', 'FT8', 'FT4']

      # Example 3: Specific DXCC entities
      # - dxcc: [291, 150, 1]  # USA, Netherlands, Canada

  # ============================================================================
  # Discord - Rare DX Channel
  # ============================================================================
  - type: discord
    name: "Rare DX Channel"
    enabled: false
    webhook_url: "${DISCORD_RARE_DX_WEBHOOK_URL}"
    username: "Rare DX Alert"
    color_scheme: "mode"

    filters:
      # Alert on specific rare DXCC entities
      - dxcc: [257, 246, 406]  # P5, FT5Z, 3Y/B

      # Alert on specific callsign patterns
      - callsign: 'VP8.*'  # Falklands
      - callsign: '3Y0.*'  # Bouvet
      - callsign: 'FT.*'   # French territories

  # ============================================================================
  # Telegram Bot Adapter
  # ============================================================================
  - type: telegram
    name: "Personal Telegram"
    enabled: true

    # Get bot_token from @BotFather
    bot_token: "${TELEGRAM_BOT_TOKEN}"

    # Get chat_id from @userinfobot or @getidsbot
    # For channels, use format: -1001234567890
    chat_id: "${TELEGRAM_CHAT_ID}"

    # Message format: 'Markdown', 'HTML', or '' for plain text
    parse_mode: "Markdown"

    # Disable link previews
    disable_web_page_preview: true

    # Add inline keyboard with lookup links
    enable_inline_keyboard: true

    timeout: 10

    filters:
      # Example: 20m and 40m only
      - bands: ['20m', '40m']

  # ============================================================================
  # Telegram - Contest Mode
  # ============================================================================
  - type: telegram
    name: "Contest Alerts"
    enabled: false
    bot_token: "${TELEGRAM_BOT_TOKEN}"
    chat_id: "${TELEGRAM_CONTEST_CHAT_ID}"
    parse_mode: "HTML"

    filters:
      # Alert on contest-related spots
      - comment_contains: 'CONTEST'
      - comment_contains: 'CQ TEST'
      - comment_contains: 'CQ WPX'
      - comment_contains: 'CQ WW'

  # ============================================================================
  # Generic Webhook Adapter
  # ============================================================================
  - type: webhook
    name: "Home Automation"
    enabled: false

    # Any HTTP endpoint
    url: "https://your-server.com/api/webhook/dxspider"

    # HTTP method
    method: "POST"

    # Custom headers (for authentication)
    headers:
      Authorization: "Bearer ${WEBHOOK_API_TOKEN}"
      X-API-Key: "${WEBHOOK_API_KEY}"
      X-Custom-Header: "value"

    # Request timeout
    timeout: 10

    # Retry configuration
    max_retries: 3
    retry_delay: 1  # Initial delay, uses exponential backoff

    filters:
      # Example: 6m band only (for Sporadic E alerts)
      - bands: ['6m']

  # ============================================================================
  # Webhook - IFTTT Integration
  # ============================================================================
  - type: webhook
    name: "IFTTT"
    enabled: false
    url: "https://maker.ifttt.com/trigger/{event}/with/key/${IFTTT_KEY}"
    method: "POST"

    filters:
      # Example: High frequency bands during contest
      - bands: ['15m', '10m']

  # ============================================================================
  # Advanced Filter Examples
  # ============================================================================

  # Multiple band filter with specific modes
  - type: discord
    name: "FT8 on HF"
    enabled: false
    webhook_url: "${DISCORD_WEBHOOK_URL}"

    filters:
      # This creates an AND filter (all conditions must match)
      - and:
          - bands: ['20m', '40m', '17m', '15m']
          - modes: ['FT8']

  # Complex OR filter
  - type: telegram
    name: "My Interests"
    enabled: false
    bot_token: "${TELEGRAM_BOT_TOKEN}"
    chat_id: "${TELEGRAM_CHAT_ID}"

    filters:
      # Any of these conditions triggers notification (OR logic)
      - bands: ['6m']                    # All 6m activity
      - modes: ['CW']                    # All CW activity
      - dxcc: [291]                      # All US stations
      - callsign: '^[A-Z]0[A-Z]{1,3}$'  # Special event calls
      - comment_contains: 'POTA'         # POTA activations
      - comment_contains: 'SOTA'         # SOTA activations

  # Frequency range filter
  - type: webhook
    name: "CW Only"
    enabled: false
    url: "https://example.com/webhook"

    filters:
      # 20m CW segment only
      - freq_min: 14000
        freq_max: 14070

  # Spotter filter
  - type: discord
    name: "Local Spotters"
    enabled: false
    webhook_url: "${DISCORD_WEBHOOK_URL}"

    filters:
      # Only spots from specific spotters
      - spotter: '9M2.*'   # Malaysian spotters
      - spotter: 'VK.*'    # Australian spotters

  # Combined filters with AND logic
  - type: telegram
    name: "DXCC Chasing"
    enabled: false
    bot_token: "${TELEGRAM_BOT_TOKEN}"
    chat_id: "${TELEGRAM_CHAT_ID}"

    filters:
      # 20m SSB, specific DXCC entities
      - and:
          - bands: ['20m']
          - modes: ['SSB']
          - dxcc: [257, 246, 406]  # Rare entities

# ============================================================================
# Environment Variable Reference
# ============================================================================
#
# Set these in your .env file or environment:
#
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...
# DISCORD_RARE_DX_WEBHOOK_URL=https://discord.com/api/webhooks/...
# TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
# TELEGRAM_CHAT_ID=-1001234567890
# TELEGRAM_CONTEST_CHAT_ID=-1009876543210
# WEBHOOK_API_TOKEN=your-api-token-here
# WEBHOOK_API_KEY=your-api-key-here
# IFTTT_KEY=your-ifttt-key

# ============================================================================
# Filter Reference
# ============================================================================
#
# Available filter types:
#
# bands:
#   List of band names: 160m, 80m, 60m, 40m, 30m, 20m, 17m, 15m, 12m, 10m, 6m, 2m, 70cm
#   Example: bands: ['20m', '40m']
#
# modes:
#   List of modes: CW, SSB, FT8, FT4, RTTY, PSK, JT65, JT9, WSPR, FM, AM
#   Example: modes: ['CW', 'FT8']
#
# dxcc:
#   List of DXCC entity numbers or prefixes
#   Example: dxcc: [291, 'K', 'W']  # USA
#
# callsign:
#   Regex pattern for callsign matching
#   Wildcards: * (any chars), ? (single char)
#   Example: callsign: 'VK*'  # Australian calls
#
# spotter:
#   Regex pattern for spotter matching
#   Example: spotter: '9M2.*'
#
# freq_min / freq_max:
#   Frequency range in kHz
#   Example: freq_min: 14000, freq_max: 14070
#
# comment_contains:
#   Text search in comment field (case insensitive)
#   Example: comment_contains: 'POTA'
#
# and:
#   Array of filters where ALL must match
#   Example:
#     and:
#       - bands: ['20m']
#       - modes: ['CW']
#
# or:
#   Array of filters where ANY must match
#   Example:
#     or:
#       - bands: ['20m']
#       - bands: ['40m']

# ============================================================================
# Testing Your Configuration
# ============================================================================
#
# 1. Copy this file: cp notifications.yml.example notifications.yml
# 2. Edit notifications.yml with your settings
# 3. Set environment variables in .env
# 4. Test with a single adapter first
# 5. Monitor DXSpider logs for notification activity
# 6. Adjust filters as needed
#
# Note: Start with a restrictive filter to avoid notification spam!
